```{r}
numeric2 <- function(theta) {
  if (theta == 0) {
    c(numeric(0))
  }
  else {
    c(theta)
  }
}
numeric2(0)
numeric2(0.2)
```


```{r functions, echo = FALSE}
nmblk <- function(n, l) {
  b <- n / l # assuming that is an integer
  idx <- sample(seq(1, n - l + 1, by = l), b, replace = TRUE) # Sample between 1 and n - l + 1, 
  # separating by l, b times
  c(outer(0:(l - 1), idx, "+")) # Creates a vector listing random blocks of size l with starting points 
  # decided by idx
}

mvblk <- function(n, l) {
  b <- n / l
  idx <- sample(1:(n - l + 1), b, replace = TRUE) # Sample any starting point between 1 and n - 1 + 1
  # they can overlap
  c(outer(0:(l - 1), idx, "+")) # Creates a vector listing random blocks of size l with starting points
  # decided by idx
}

blkboot <- function(tseries, statistic, R, l) {
  n <- length(tseries) 
  ## observed statistic
  stat <- statistic(tseries) #stat stores a certain statistic of tseries using a function
  ## nonmoving block bootstrap
  nm.stat <- replicate(R, statistic(tseries[nmblk(n, l)])) # finds the statistic of nm bootstrap and repeats R times
  ## moving block bootstrap
  mv.stat <- replicate(R, statistic(tseries[mvblk(n, l)])) # finds the statistic of mv bootstrap and repeats R times
  list(stat = stat, nm.stat = nm.stat, mv.stat = mv.stat) # returns list of three values
}

do1rep <- function(n, theta, sigma,
                   target,
                   len, statistic, B = 1000) {
  x <- arima.sim(list(ar = numeric2(theta)), n = n, sd = sigma * sqrt(1-theta^2))
  ## sd is the standard deviation of the noise -> true_variance(X_t) = sd^2/(1 - theta^2)
  bt <- blkboot(x, statistic, B, len) 

  ## two intervals  
  nm = quantile(bt$nm.stat, probs = c(0.025, 0.975))
  mv = quantile(bt$mv.stat, probs = c(0.025, 0.975))
  
  nm.cov <- nm[1] < target && target < nm[2]
  mv.cov <- mv[1] < target && target < mv[2]
  
  ## c(bt$stat, sd(bt$nm.stat), nm_interval, nm_contains, sd(bt$mv.stat), mv_interval, mv_contains) 

  ## returns statistics and standard error's for nm and mv respectively, standard error (sd(bt$mv.stat) is estimated as the sqrt(sample_variance(X_t) / n)
  c(nm.cov, mv.cov)
}

```

```{r more_functions, echo = False}
options(max.print = 1000000)
#ar1 <- function(x) cor(x[-1], x[-length(x)])
ar1 <- function(x) acf(x, plot = FALSE, lag.max = 1)$acf[2]
m1 <- function(x) mean(x)

my_summary <- function(x)
{
  rm = rowMeans(x)
  c(rm, rm[1] - qnorm(.975) * sqrt((rm[1] * (1 - rm[1])) / 4000), rm[1] + qnorm(.975) * sqrt((rm[1] * (1 - rm[1])) / 4000),  rm[2] - qnorm(.975) * sqrt((rm[2] * (1 - rm[2])) / 4000), rm[2] + qnorm(.975) * sqrt((rm[2] * (1 - rm[2])) / 4000))
}

```


```{r}
asdf <- c(32, my_summary(replicate(200, do1rep(n = 32, theta = 0.2, sigma = 0.1, target = 0, len = ceiling(32**(1/3)), statistic = m1))))
```

```{r}
qwer <- c(64, my_summary(replicate(200, do1rep(n = 64, theta = 0.4, sigma = 0.1, target = 0.4, len = ceiling(64**(1/3)), statistic = ar1))))
```

```{r}
do1rep(n = 64, theta = 0.4, sigma = 0.1, target = 0.4, len = ceiling(64**(1/3)), statistic = ar1)
```

```{r}
zxcv <- data.frame(rbind(asdf, qwer))
colnames(zxcv) <- c('Sample Length', 'Non-Moving Coverage Rate', 'Moving Coverage Rate', 'Non-Moving Lower Bound', 'Non-Moving Upper Bound', 'Moving Lower Bound', 'Moving Upper Bound')
zxcv
```

```{r Normal Sample n = 32}
set.seed(1)
(m_norm_32 = c(32, my_summary(replicate(4000, do1rep(32, 0, 0.1, 0, ceiling(32**(1/3)), m1)))))
set.seed(1)
(ar_norm_32 = c(32, my_summary(replicate(4000, do1rep(32, 0, 0.1, 0, ceiling(32**(1/3)), ar1)))))
```

```{r Normal Sample n = 64}
set.seed(5)
(m_norm_64 = c(64, my_summary(replicate(4000, do1rep(64, 0, 0.1, 0, ceiling(64**(1/3)), m1)))))
set.seed(5)
(ar_norm_64 = c(64, my_summary(replicate(4000, do1rep(64, 0, 0.1, 0, ceiling(64**(1/3)), ar1)))))
```

```{r Normal Sample n = 128}
set.seed(10)
(m_norm_128 = c(128, my_summary(replicate(4000, do1rep(128, 0, 0.1, 0, ceiling(128**(1/3)), m1)))))
set.seed(10)
(ar_norm_128 = c(128, my_summary(replicate(4000, do1rep(128, 0, 0.1, 0, ceiling(128**(1/3)), ar1)))))
```

```{r Normal Sample n = 256}
set.seed(50)
(m_norm_256 = c(256, my_summary(replicate(4000, do1rep(256, 0, 0.1, 0, ceiling(256**(1/3)), m1)))))
set.seed(50)
(ar_norm_256 = c(256, my_summary(replicate(4000, do1rep(256, 0, 0.1, 0, ceiling(256**(1/3)), ar1)))))
```

```{r Normal Sample n = 512}
set.seed(100)
(m_norm_512 = c(512, my_summary(replicate(4000, do1rep(512, 0, 0.1, 0, ceiling(512**(1/3)), m1)))))
set.seed(100)
(ar_norm_512 = c(512, my_summary(replicate(4000, do1rep(512, 0, 0.1, 0, ceiling(512**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 32}
set.seed(1)
(m_0.2_32 = c(32, my_summary(replicate(4000, do1rep(32, 0.2, 0.1, 0, ceiling(32**(1/3)), m1)))))
set.seed(1)
(ar_0.2_32 = c(32, my_summary(replicate(4000, do1rep(32, 0.2, 0.1, 0.2, ceiling(32**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 64}
set.seed(5)
(m_0.2_64 = c(64, my_summary(replicate(4000, do1rep(64, 0.2, 0.1, 0, ceiling(64**(1/3)), m1)))))
set.seed(5)
(ar_0.2_64 = c(64, my_summary(replicate(4000, do1rep(64, 0.2, 0.1, 0.2, ceiling(64**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 128}
set.seed(10)
(m_0.2_128 = c(128, my_summary(replicate(4000, do1rep(128, 0.2, 0.1, 0, ceiling(128**(1/3)), m1)))))
set.seed(10)
(ar_0.2_128 = c(128, my_summary(replicate(4000, do1rep(128, 0.2, 0.1, 0.2, ceiling(128**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 256}
set.seed(50)
(m_0.2_256 = c(256, my_summary(replicate(4000, do1rep(256, 0.2, 0.1, 0, ceiling(256**(1/3)), m1)))))
set.seed(50)
(ar_0.2_256 = c(256, my_summary(replicate(4000, do1rep(256, 0.2, 0.1, 0.2, ceiling(256**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 512}
set.seed(100)
(m_0.2_512 = c(512, my_summary(replicate(4000, do1rep(512, 0.2, 0.1, 0, ceiling(512**(1/3)), m1)))))
set.seed(100)
(ar_0.2_512 = c(512, my_summary(replicate(4000, do1rep(512, 0.2, 0.1, 0.2, ceiling(512**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 1024}
set.seed(500)
(m_0.2_1024 = c(1024, my_summary(replicate(4000, do1rep(1024, 0.2, 0.1, 0, ceiling(1024**(1/3)), m1)))))
set.seed(500)
(ar_0.2_1024 = c(1024, my_summary(replicate(4000, do1rep(1024, 0.2, 0.1, 0.2, ceiling(1024**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 2048}
set.seed(1000)
(m_0.2_2048 = c(2048, my_summary(replicate(4000, do1rep(2048, 0.2, 0.1, 0, ceiling(2048**(1/3)), m1)))))
set.seed(1000)
(ar_0.2_2048 = c(2048, my_summary(replicate(4000, do1rep(2048, 0.2, 0.1, 0.2, ceiling(2048**(1/3)), ar1)))))
```

```{r AR = 0.2 Sample n = 4096}
set.seed(5000)
(m_0.2_4096 = c(4096, my_summary(replicate(4000, do1rep(4096, 0.2, 0.1, 0, ceiling(4096**(1/3)), m1)))))
set.seed(5000)
(ar_0.2_4096 = c(4096, my_summary(replicate(4000, do1rep(4096, 0.2, 0.1, 0.2, ceiling(4096**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 32}
set.seed(1)
(m_0.4_32 = c(32, my_summary(replicate(4000, do1rep(32, 0.4, 0.1, 0, ceiling(32**(1/3)), m1)))))
set.seed(1)
(ar_0.4_32 = c(32, my_summary(replicate(4000, do1rep(32, 0.4, 0.1, 0.4, ceiling(32**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 64}
set.seed(5)
(m_0.4_64 = c(64, my_summary(replicate(4000, do1rep(64, 0.4, 0.1, 0, ceiling(64**(1/3)), m1)))))
set.seed(5)
(ar_0.4_64 = c(64, my_summary(replicate(4000, do1rep(64, 0.4, 0.1, 0.4, ceiling(64**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 128}
set.seed(10)
(m_0.4_128 = c(128, my_summary(replicate(4000, do1rep(128, 0.4, 0.1, 0, ceiling(128**(1/3)), m1)))))
set.seed(10)
(ar_0.4_128 = c(128, my_summary(replicate(4000, do1rep(128, 0.4, 0.1, 0.4, ceiling(128**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 256}
set.seed(50)
(m_0.4_256 = c(256, my_summary(replicate(4000, do1rep(256, 0.4, 0.1, 0, ceiling(256**(1/3)), m1)))))
set.seed(50)
(ar_0.4_256 = c(256, my_summary(replicate(4000, do1rep(256, 0.4, 0.1, 0.4, ceiling(256**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 512}
set.seed(100)
(m_0.4_512 = c(512, my_summary(replicate(4000, do1rep(512, 0.4, 0.1, 0, ceiling(512**(1/3)), m1)))))
set.seed(100)
(ar_0.4_512 = c(512, my_summary(replicate(4000, do1rep(512, 0.4, 0.1, 0.4, ceiling(512**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 1024}
set.seed(500)
(m_0.4_1024 = c(1024, my_summary(replicate(4000, do1rep(1024, 0.4, 0.1, 0, ceiling(1024**(1/3)), m1)))))
set.seed(500)
(ar_0.4_1024 = c(1024, my_summary(replicate(4000, do1rep(1024, 0.4, 0.1, 0.4, ceiling(1024**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 2048}
set.seed(1000)
(m_0.4_2048 = c(2048, my_summary(replicate(4000, do1rep(2048, 0.4, 0.1, 0, ceiling(2048**(1/3)), m1)))))
set.seed(1000)
(ar_0.4_2048 = c(2048, my_summary(replicate(4000, do1rep(2048, 0.4, 0.1, 0.4, ceiling(2048**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 4096}
set.seed(5000)
(m_0.4_4096 = c(4096, my_summary(replicate(4000, do1rep(4096, 0.4, 0.1, 0, ceiling(4096**(1/3)), m1)))))
set.seed(5000)
(ar_0.4_4096 = c(4096, my_summary(replicate(4000, do1rep(4096, 0.4, 0.1, 0.4, ceiling(4096**(1/3)), ar1)))))
```

```{r AR = 0.4 Sample n = 8192}
set.seed(10000)
(m_0.4_8192 = c(8192, my_summary(replicate(4000, do1rep(8192, 0.4, 0.1, 0, ceiling(8192**(1/3)), m1)))))
set.seed(10000)
(ar_0.4_8192 = c(8192, my_summary(replicate(4000, do1rep(8192, 0.4, 0.1, 0.4, ceiling(8192**(1/3)), ar1)))))
```

```{r}
m_0 <- data.frame(rbind(m_norm_32, m_norm_64, m_norm_128, m_norm_256, m_norm_512))
ar_0 <- data.frame(rbind(ar_norm_32, ar_norm_64, ar_norm_128, ar_norm_256, ar_norm_512))
m_0.2 <- data.frame(rbind(m_0.2_32, m_0.2_64, m_0.2_128, m_0.2_256, m_0.2_512, m_0.2_1024, m_0.2_2048, m_0.2_4096))
ar_0.2 <- data.frame(rbind(ar_0.2_32, ar_0.2_64, ar_0.2_128, ar_0.2_256, ar_0.2_512, ar_0.2_1024, ar_0.2_2048, ar_0.2_4096))
m_0.4 <- data.frame(rbind(m_0.4_32, m_0.4_64, m_0.4_128, m_0.4_256, m_0.4_512, m_0.4_1024, m_0.4_2048, m_0.4_4096, m_0.4_8192))
ar_0.4 <- data.frame(rbind(ar_0.4_32, ar_0.4_64, ar_0.4_128, ar_0.4_256, ar_0.4_512, ar_0.4_1024, ar_0.4_2048, ar_0.4_4096, ar_0.4_8192))
colnames(m_0) <- c('Sample Length', 'Non-Moving Coverage Rate', 'Moving Coverage Rate', 'Non-Moving Lower Bound', 'Non-Moving Upper Bound', 'Moving Lower Bound', 'Moving Upper Bound')
colnames(ar_0) <- c('Sample Length', 'Non-Moving Coverage Rate', 'Moving Coverage Rate', 'Non-Moving Lower Bound', 'Non-Moving Upper Bound', 'Moving Lower Bound', 'Moving Upper Bound')
colnames(m_0.2) <- c('Sample Length', 'Non-Moving Coverage Rate', 'Moving Coverage Rate', 'Non-Moving Lower Bound', 'Non-Moving Upper Bound', 'Moving Lower Bound', 'Moving Upper Bound')
colnames(ar_0.2) <- c('Sample Length', 'Non-Moving Coverage Rate', 'Moving Coverage Rate', 'Non-Moving Lower Bound', 'Non-Moving Upper Bound', 'Moving Lower Bound', 'Moving Upper Bound')
colnames(m_0.4) <- c('Sample Length', 'Non-Moving Coverage Rate', 'Moving Coverage Rate', 'Non-Moving Lower Bound', 'Non-Moving Upper Bound', 'Moving Lower Bound', 'Moving Upper Bound')
colnames(ar_0.4) <- c('Sample Length', 'Non-Moving Coverage Rate', 'Moving Coverage Rate', 'Non-Moving Lower Bound', 'Non-Moving Upper Bound', 'Moving Lower Bound', 'Moving Upper Bound')
m_0
ar_0
m_0.2
ar_0.2
m_0.4
ar_0.4
write.csv(m_0,"../Data/m_0.csv", row.names = FALSE)
write.csv(ar_0,"../Data/ar_0.csv", row.names = FALSE)
write.csv(m_0.2,"../Data/m_0.2.csv", row.names = FALSE)
write.csv(ar_0.2,"../Data/ar_0.2.csv", row.names = FALSE)
write.csv(m_0.4,"../Data/m_0.4.csv", row.names = FALSE)
write.csv(ar_0.4,"../Data/ar_0.4.csv", row.names = FALSE)
```
